function nodeGetAsync(e,n){request.get(e).end(function(e,t){e?cb(e):n(null,t.text)})}function httpGetAsync(e,n){var t=new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==XMLHttpRequest.DONE&&200==t.status?n(null,t.responseText):n(new Error("not a 200 response"))},t.open("GET",e,!0),t.send(null)}function toObj(e,n){if(9==e.nodeType)return toObj(e.documentElement,n);var t={};if(!n||n instanceof Array)return 1==e.nodeType?t[e.nodeName]=toObj(e,t):err("unhandled node type: "+e.nodeType),t;if(1==e.nodeType){if(e.attributes.length)for(var r=0;r<e.attributes.length;r++)n[e.nodeName+"@"+e.attributes[r].nodeName]=e.attributes[r].nodeValue;if(e.firstChild){for(var o=0,i=0,a=!1,l=!1,s={},d=e.firstChild;d;d=d.nextSibling)1==d.nodeType?(a=!0,s[d.nodeName]=s[d.nodeName]?s[d.nodeName]+1:1,s[d.nodeName]>1&&(l=!0)):3==d.nodeType&&d.nodeValue.match(/[^ \f\n\r\t\v]/)?o++:4==d.nodeType&&i++;if(a&&o&&(l=!0),a&&i&&(l=!0),o&&i&&(l=!0),i>1&&(l=!0),a&&!l){removeWhite(e);for(var d=e.firstChild;d;d=d.nextSibling)3==d.nodeType?t["#text"]=escape(d.nodeValue):4==d.nodeType?t["#cdata"]=escape(d.nodeValue):t[d.nodeName]?t[d.nodeName]instanceof Array?t[d.nodeName][t[d.nodeName].length]=toObj(d,t):t[d.nodeName]=[t[d.nodeName],toObj(d,t)]:t[d.nodeName]=toObj(d,t)}else if(l){t=[],removeWhite(e);for(var d=e.firstChild;d;d=d.nextSibling)3==d.nodeType?t[t.length]=escape(d.nodeValue):4==d.nodeType?t[t.length]={"#cdata":escape(d.nodeValue)}:t[t.length]=toObj(d,t)}else o?t=escape(innerXml(e)):i&&(removeWhite(e),t["#cdata"]=escape(e.firstChild.nodeValue))}e.firstChild||(t=null)}else err("unhandled node type: "+e.nodeType);return t}function err(e){console.error("Error:",e)}function toJson(e,n){var t="";if(e instanceof Array){for(var r=0,o=e.length;o>r;r++){var i="";"string"==typeof e[r]&&(i=n+"	"),e[r]=i+toJson(e[r],n+"	")}t+="["+(e.length>1?"\n"+e.join(",\n")+"\n"+n:e.join(""))+"]"}else if(null==e)t+="null";else if("string"==typeof e)t+='"'+e.toString()+'"';else if("object"==typeof e){t+=n+"{";var r=0;for(var a in e)r++;for(var a in e)t+="\n"+n+'	"'+a+'":'+toJson(e[a],n+"	"),t+=r>1?",":"\n"+n,r--;t+="}"}else t+=e.toString();return t}function innerXml(e){var n="";if("innerHTML"in e)n=e.innerHTML;else for(var t=function(e){var n="";if(1==e.nodeType){n+="<"+e.nodeName;for(var r=0;r<e.attributes.length;r++)n+=" "+e.attributes[r].nodeName+'="'+(e.attributes[r].nodeValue||"").toString()+'"';if(e.firstChild){n+=">";for(var o=e.firstChild;o;o=o.nextSibling)n+=t(o);n+="</"+e.nodeName+">"}else n+="/>"}else 3==e.nodeType?n+=e.nodeValue:4==e.nodeType&&(n+="<![CDATA["+e.nodeValue+"]]>");return n},r=e.firstChild;r;r=r.nextSibling)n+=t(r);return n}function escape(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")}function removeWhite(e){e.normalize();for(var n=e.firstChild;n;)if(3==n.nodeType)if(n.nodeValue.match(/[^ \f\n\r\t\v]/))n=n.nextSibling;else{var t=n.nextSibling;e.removeChild(n),n=t}else 1==n.nodeType?(removeWhite(n),n=n.nextSibling):n=n.nextSibling;return e}var tax={};if("undefined"==typeof window)var request=require("superagent"),parseString=require("xml2js").parseString;tax.get=function(e,n){"undefined"!=typeof window?httpGetAsync(e,n):nodeGetAsync(e,n)},tax.eSpell=function(e,n){var t="http://eutils.ncbi.nlm.nih.gov/entrez/eutils/espell.fcgi?term="+e+"&db=taxonomy";tax.get(t,function(e,t){t&&tax.xmlToJson(t,function(e,t){if(e)n(e);else{var r=t.eSpellResult.CorrectedQuery;n(null,r)}})})},tax.eSearch=function(e,n){var t="http://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=taxonomy&term="+e+"&retmode=json";tax.get(t,function(e,t){if(t){var r=JSON.parse(t);n(null,r.esearchresult.idlist)}})},tax.eFetch=function(e,n){var t="http://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=taxonomy&id="+e;tax.get(t,function(e,t){t&&tax.xmlToJson(t,function(e,t){if(e)n(e);else{var r=t.TaxaSet;n(null,r)}})})},stringToXML=function(e){try{var n=null;if(window.DOMParser||DOMParser){var t=new DOMParser;return n=t.parseFromString(e,"text/xml")}return n=new ActiveXObject("Microsoft.XMLDOM"),n.async=!1,n.loadXML(e),n}catch(r){return null}},tax.xmlToJson=function(e,n){if("undefined"==typeof window)parseString(e,function(e,t){n(e,t)});else{var t=stringToXML(e);9==t.nodeType&&(t=t.documentElement);var r=toObj(removeWhite(t)),o=toJson(r,""),i=JSON.parse(o.replace(/\t|\n/g,""));n(null,i)}},"undefined"==typeof window&&(module.exports=tax);